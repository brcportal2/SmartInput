!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SmartInput=t()}(this,function(){function e(e){function t(e){if(!b.disabled){var t=e.clipboardData||window.clipboardData;return setTimeout(y,0),h(e,t,!0)}}function s(t){if(L.classList.remove(e.dropClass||u),!b.disabled){var n=t.dataTransfer||window.dataTransfer;return setTimeout(y,0),h(t,n,!1)}}function c(e){if(b.disabled)return!1;n(e.dataTransfer||window.dataTransfer)||a(e)}function d(e){if(b.disabled)return!1;var t=e.dataTransfer,n=t&&t.types&&Array.prototype.slice.call(t.types);n&&~n.indexOf("Files")&&L.classList.add(k)}function f(e){e.target===L&&L.classList.remove(k)}function h(e,t,r){function i(){if(r)try{var n=t.getData("text/plain");if(n)return document.execCommand("insertText",!1,n),a(e)}catch(e){}return!0}var l=t&&t.types&&Array.prototype.slice.call(t.types);if(!l||~l.indexOf("Files")){var o=n(t);return null!==o?(o.forEach(function(e){b.emit("inputFile",e)}),a(e)):i()}return 0===l.length||(1===l.length&&"text/html"===l[0]||i())}function p(){b.disabled||(_(),y(),g())}function v(){b.disabled||(_(),y(),g())}function m(e){var t=b.__hotkeyHandlerDataMap[e.keyCode];if(t&&0!==t.length){var n=!1;return t.filter(function(t){var n=t.hotkey;return!!n&&((null==n.ctrl||Boolean(e.ctrlKey)===Boolean(t.ctrl))&&((null==n.alt||Boolean(e.altKey)===Boolean(t.alt))&&(null==n.shift||Boolean(e.shiftKey)===Boolean(t.shift))))}).forEach(function(t){try{!1===t.handler.call(b,e)&&(n=!0)}catch(n){b.emit("error",n,t.hotkey,e)}}),!n}}function _(){var t=Array.prototype.slice.call(L.querySelectorAll("img")),n=e&&e.filterImage;"function"==typeof n&&(t=t.filter(function(e){try{return!n(e)}catch(e){return!0}})),t.forEach(function(e){var t=e.getAttribute("src");if(0===t.indexOf("data:")){var n=o(t);b.emit("inputFile",n)}var r=e.parentElement;r&&r.removeChild(e)})}function y(){var e=l(L);b.__value!==e&&(b.__value=e,b.emit("change",e))}function g(){if(!b.__value){for(var e=Array.prototype.slice.call(L.childNodes),t=0;t<e.length;t++){var n=e[t];(n.nodeType!==Node.TEXT_NODE||n.nodeValue)&&L.removeChild(n)}0===e.length&&L.appendChild(document.createTextNode(""))}}this.__eventHandlerMap=Object.create(null),this.__hotkeyHandlerDataMap=Object.create(null);var b=this;if(e||(e={}),"function"==typeof e){var E=Object.create(null);(e=e.call(this,E))||(e=E)}var k=e&&e.dropClass||u,L=this.__element=e.element||function(){var e=document.createElement("div");return L.setAttribute("contenteditable","true"),e}();y(),L.addEventListener("paste",t),L.addEventListener("keydown",m),L.addEventListener("keyup",v),L.addEventListener("input",p),L.addEventListener("drop",s),L.addEventListener("dragover",c),L.addEventListener("dragenter",d),L.addEventListener("dragleave",f),this.__removeEventListeners=function(){L.removeEventListener("paste",t),L.removeEventListener("keydown",m),L.removeEventListener("keyup",v),L.removeEventListener("input",p),L.removeEventListener("drop",s),L.removeEventListener("dragover",c),L.removeEventListener("dragenter",d),L.removeEventListener("dragleave",f),b.__removeEventListeners=null},this.__updateText=function(){i(this.__element),r(this.__value).forEach(function(e){this.__element.appendChild(e)},this),g()}}function t(e,t){return e===t||!(!e||!t)&&(Number(e.key)===Number(t.key)&&(Boolean(e.ctrl)===Boolean(t.ctrl)&&(Boolean(e.alt)===Boolean(t.alt)&&Boolean(e.shift)===Boolean(t.shift))))}function n(e){return e.files&&e.files.length?Array.prototype.slice.call(e.files):e.items&&e.items.length?Array.prototype.slice.call(e.items||[]).map(function(e){return e.getAsFile()}):null}function r(e){return e.split("\n").map(function(e){var t=document.createElement("div");if(e){var n=e.replace(/^ /g," ").replace(/ {2}/g,"  ");t.appendChild(document.createTextNode(n))}else t.appendChild(document.createElement("br"));return t})}function i(e){for(var t;t=e.lastChild;)e.removeChild(t);return e}function a(e){return!!(e=e||window.event)&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.cancelBubble=!0,!1)}function l(e){function t(){var e=i.join("");e=e.replace(/\r\n/g,"\n").replace(/\r+/g," "),r.push(e),i=[]}function n(e){if(e.nodeType!==Node.TEXT_NODE){if(e.nodeType===Node.ELEMENT_NODE){var a=!1;if("BR"===e.tagName)return t();if("IMG"===e.tagName)return void(e.alt&&i.push(e.alt));if("DIV"!==e.tagName&&"P"!==e.tagName||(a=!0),a&&i.length&&t(),a&&!e.firstChild&&!i.length)return void r.push("");for(var l=e.firstChild;l;)n(l),l=l.nextSibling;a&&i.length&&t()}}else{var o=e.nodeValue;if(!o)return;i.push(o)}}var r=[],i=[];return n(e),r.join("\n").replace(/\u00A0/g," ")}function o(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),i=r.length,a=new Uint8Array(i);i--;)a[i]=r.charCodeAt(i);return new Blob([a],{type:n})}var u="smart-input-drop-target";return Object.defineProperties(e.prototype,{element:{get:function(){return this.__element}},value:{get:function(){if(this.__element)return this.__value},set:function(e){this.__element&&this.__value!==e&&(this.__value=e,this.__updateText())}},placeholder:{get:function(){return this.__element?this.__element.getAttribute("placeholder"):null},set:function(e){this.__element&&this.__element.setAttribute("placeholder",e)}},disabled:{get:function(){if(this.__element)return!this.__element.getAttribute("contenteditable")},set:function(e){e?this.__element.removeAttribute("contenteditable"):this.__element.setAttribute("contenteditable","true")}}}),e.prototype.destroy=function(){return this.__removeEventListeners&&this.__removeEventListeners(),!!this.__element&&(this.__element=null,!0)},e.prototype.on=function(e,t){var n=this.__eventHandlerMap;return(n[e]=n[e]||[]).push(t),this},e.prototype.off=function(e,t){var n=this.__eventHandlerMap;if(1===arguments.length)return delete n[e],this;var r=n[e]=n[e]||[],i=r.lastIndexOf(t);return r.splice(i,1),r.length||delete n[e],this},e.prototype.emit=function(e){var t=this.__eventHandlerMap[e];if(!t||0===t.length)return this;for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);return t.forEach(function(t){try{t.apply(this,n)}catch(t){"error"!==e&&this.emit("error",t,e,n)}},this),this},e.prototype.onHotkey=function(e,t){var n={key:e.key,shift:null!=e.shift?Boolean(e.shift):null,ctrl:null!=e.ctrl?Boolean(e.ctrl):null,alt:null!=e.alt?Boolean(e.alt):null},r=this.__hotkeyHandlerDataMap;return(r[Number(n.key)]=r[Number(n.key)]||[]).push({hotkey:n,handler:t}),this},e.prototype.offHotkey=function(e,n){var r=this.__hotkeyHandlerDataMap;if(1===arguments.length)return delete r[Number(e.key)],this;for(var i=0,a=r[Number(e.key)]=r[Number(e.key)]||[];i<a.length;){var l=a[i].hotkey;t(e,l)?l.splice(i,1):i++}return this},e});