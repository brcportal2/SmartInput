!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SmartInput=t()}(this,function(){function e(e){function t(){return B.updateValue()}function n(e){if(!B.disabled){var n=e.clipboardData||window.clipboardData;return setTimeout(t,0),setTimeout(A,0),_(e,n,!0)}}function r(e){if(O.classList.remove(k),O.classList.remove(D),!B.disabled){var n=e.dataTransfer||window.dataTransfer;if(setTimeout(t,0),setTimeout(A,0),B.__allowDropFiles)return _(e,n,!1)}}function u(e){return!B.disabled&&(!B.__allowDropFiles||void(l(e.dataTransfer||window.dataTransfer)&&s(e)))}function d(e){return!B.disabled&&(O.classList.add(k),!B.__allowDropFiles||void(l(e.dataTransfer)&&O.classList.add(D)))}function _(e,t,n){function r(){try{var n=t.getData("text/plain");if(n)return document.execCommand("insertText",!1,n),s(e)}catch(e){}return!0}var l=t&&t.types&&Array.prototype.slice.call(t.types);if(!l||~l.indexOf("Files")){var a=i(t);return null!==a?(a.forEach(function(e){B.emit("inputFile",e)}),s(e)):r()}return 0===l.length||(1===l.length&&"text/html"===l[0]||(!n||r()))}function m(){B.disabled||(A(),L(),B.updateValue(),N())}function v(){B.disabled||(L(),B.updateValue(),N(),setTimeout(T,0))}function g(e){T();var t=B.__hotkeyHandlerDataMap[e.keyCode];if(t&&0!==t.length){var n=!1;return t.filter(function(t){var n=t.hotkey;return!!n&&((null==n.ctrl||Boolean(e.ctrlKey)===Boolean(n.ctrl))&&((null==n.alt||Boolean(e.altKey)===Boolean(n.alt))&&((null==n.shift||Boolean(e.shiftKey)===Boolean(n.shift))&&(null==n.meta||Boolean(e.metaKey)===Boolean(n.meta)))))}).forEach(function(t){try{!1===t.handler.call(B,e)&&(n=!0)}catch(n){B.emit("error",n,t.hotkey,e)}}),!n}}function y(){B.__clearOnBlur&&E(),b()}function E(){var e=window.getSelection();e.removeAllRanges();var t=document.createRange();t.setStart(document.body,0),t.setEnd(document.body,document.body.childNodes.length),e.addRange(t),e.removeAllRanges()}function b(){B.isInRange()||(B.__lastRange=null);var e=window.getSelection();try{B.__lastRange=e.getRangeAt(0),B.__lastRangeContainers={start:B.__lastRange.startContainer,end:B.__lastRange.endContainer}}catch(e){B.__lastRange=null,B.__lastRangeContainers=null}}function A(){var e=O.querySelectorAll("*[style],*[class]");e&&Array.prototype.slice.call(e).forEach(function(e){e.removeAttribute("style"),e.removeAttribute("class")})}function L(){var t=Array.prototype.slice.call(O.querySelectorAll("img")),n=e&&e.filterImage;"function"==typeof n&&(t=t.filter(function(e){try{return!n(e)}catch(e){return!0}})),t.forEach(function(e){var t=e.getAttribute("src");if(0===t.indexOf("data:")){var n=c(t);B.emit("inputFile",n)}var r=e.parentElement;r&&r.removeChild(e)}),Array.prototype.slice.call(O.querySelectorAll("svg,canvas")).forEach(function(e){var t=e.parentElement;t&&t.removeChild(e)})}function N(){return B.__value?R():O.querySelectorAll("div,p").length>0?R():O.querySelectorAll("br").length>1?R():w()}function R(){f(O);for(var e=Array.prototype.slice.call(O.querySelectorAll("div")),t=0;t<e.length;t++)f(e[t])}function w(){for(var e=Array.prototype.slice.call(O.childNodes),t=0;t<e.length;t++){var n=e[t];O.removeChild(n)}}function T(){try{var e=window.getSelection(),t=e.getRangeAt(0);if(t.endContainer!==O)return;var n=t.endOffset;if(0==n)return;if(n!==O.childNodes.length)return;if(t.startContainer==O&&0==t.startOffset)return;t.setEnd(t.endContainer,n-1),e.removeAllRanges(),e.addRange(t)}catch(e){}}this.__eventHandlerMap=Object.create(null),this.__hotkeyHandlerDataMap=Object.create(null),this.__allowDropFiles=!0,this.__clearOnBlur=!1;var B=this;if(e||(e={}),"function"==typeof e){var C=Object.create(null);(e=e.call(this,C))||(e=C)}var D=e&&e.dropClass||h,k=e&&e.dragClass||p;"allowDropFiles"in e&&!e.allowDropFiles&&(this.__allowDropFiles=!1),"disabled"in e&&(this.disabled=e.disabled),"clearOnBlur"in e&&(this.__clearOnBlur=!!e.clearOnBlur);var O;if("string"==typeof e.element){try{O=document.querySelector(e.element)}catch(e){}if(!O)throw new Error("Wrong query selector: "+e.element)}else"object"==typeof e.element?O=e.element[0]||e.element:function(){var e=document.createElement("div");O.setAttribute("contenteditable","true")}();this.__element=O,O.addEventListener("paste",n),O.addEventListener("keydown",g),O.addEventListener("keyup",v),O.addEventListener("input",m),O.addEventListener("drop",r),O.addEventListener("dragover",u),O.addEventListener("dragenter",d),O.addEventListener("dragleave",function(e){e.target===O&&(O.classList.remove(k),O.classList.remove(D))}),O.addEventListener("blur",y),this.__removeEventListeners=function(){O.removeEventListener("paste",n),O.removeEventListener("keydown",g),O.removeEventListener("keyup",v),O.removeEventListener("input",m),O.removeEventListener("drop",r),O.removeEventListener("dragover",u),O.removeEventListener("dragenter",d),O.removeEventListener("blur",y),B.__removeEventListeners=null},this.__setText=function(e){o(this.__element),a(e).forEach(function(e){this.__element.appendChild(e)},this),this.updateValue(),N()},this.updateValue()}function t(e){"function"==typeof e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded(!0):d.call(e,!0)}function n(e,t){for(var n=t;null!=n;){if(n==e)return!0;n=n.parentNode}return!1}function r(e,t){return e===t||!(!e||!t)&&(Number(e.key)===Number(t.key)&&(Boolean(e.ctrl)===Boolean(t.ctrl)&&(Boolean(e.alt)===Boolean(t.alt)&&(Boolean(e.shift)===Boolean(t.shift)&&Boolean(e.meta)===Boolean(t.meta)))))}function l(e){var t=e.types&&Array.prototype.slice.call(e.types);if(t&&~t.indexOf("Files"))return!0;if(e.files&&e.files.length)return!0;if(e.items)for(var n=0;n<e.items.length;n++)if("file"===e.items[n].type)return!0;return!1}function i(e){if(e.files&&e.files.length)return Array.prototype.slice.call(e.files);if(e.items&&e.items.length){var t=Array.prototype.slice.call(e.items||[]),n=t&&t.map(function(e){return e.getAsFile()}).filter(function(e){return e});if(n&&n.length)return n}return null}function a(e){return e.split("\n").map(function(e){return e.replace(/^ /g," ").replace(/ {2}/g,"  ")}).reduce(function(e,t){return e.push(document.createElement("BR")),t&&e.push(document.createTextNode(t)),e},[]).slice(1)}function o(e){for(var t;t=e.lastChild;)e.removeChild(t);return e}function s(e){return!!(e=e||window.event)&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.cancelBubble=!0,!1)}function u(e){function t(){var e=l.join("");e=e.replace(/\r\n/g,"\n").replace(/\r+/g," "),r.push(e),l=[]}function n(e){if(e.nodeType!==Node.TEXT_NODE){if(e.nodeType===Node.ELEMENT_NODE){var i=!1;if("BR"===e.tagName)return t();if("IMG"===e.tagName)return void(e.alt&&l.push(e.alt));if("DIV"!==e.tagName&&"P"!==e.tagName||(i=!0),i&&l.length&&t(),i&&!e.firstChild&&!l.length)return void r.push("");for(var a=e.firstChild;a;)n(a),a=a.nextSibling;i&&l.length&&t()}}else{var o=e.nodeValue;if(!o)return;l.push(o)}}var r=[],l=[];return n(e),r.join("\n").replace(/\u00A0/g," ")}function c(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),l=r.length,i=new Uint8Array(l);l--;)i[l]=r.charCodeAt(l);return new Blob([i],{type:n})}function f(e){var t=Array.prototype.slice.call(e.childNodes),n=t[t.length-1],r=n.nodeType===Node.ELEMENT_NODE,l=r&&"BR"===n.tagName,i=r&&"DIV"===n.tagName;if(!l&&!i){var a=document.createElement("BR");a.setAttribute("type","auto"),e.appendChild(a)}}function d(e){function t(t,n,r,l){return!1===e||r<=t+l&&t<=n+l?Math.min(r,Math.max(n,t)):(n+r)/2}function n(e,t,r,l){return{left:e,top:t,width:r,height:l,right:e+r,bottom:t+l,translate:function(i,a){return n(i+e,a+t,r,l)},relativeFromTo:function(a,o){var s=e,u=t;if(a=a.offsetParent,o=o.offsetParent,a===o)return i;for(;a;a=a.offsetParent)s+=a.offsetLeft+a.clientLeft,u+=a.offsetTop+a.clientTop;for(;o;o=o.offsetParent)s-=o.offsetLeft+o.clientLeft,u-=o.offsetTop+o.clientTop;return n(s,u,r,l)}}}for(var r,l=this,i=n(this.offsetLeft,this.offsetTop,this.offsetWidth,this.offsetHeight);(r=l.parentNode)instanceof HTMLElement;){var a=r.offsetLeft+r.clientLeft,o=r.offsetTop+r.clientTop;i=i.relativeFromTo(l,r).translate(-a,-o),r.scrollLeft=t(r.scrollLeft,i.right-r.clientWidth,i.left,r.clientWidth),r.scrollTop=t(r.scrollTop,i.bottom-r.clientHeight,i.top,r.clientHeight),i=i.translate(a-r.scrollLeft,o-r.scrollTop),l=r}}var h="smart-input-drop-target",p="smart-input-drag";return Object.defineProperties(e.prototype,{element:{get:function(){return this.__element}},value:{get:function(){if(this.__element)return this.__value},set:function(e){"string"!=typeof e&&(e=null==e?"":String(e)),this.__element&&this.__value!=e&&this.__setText(e)}},placeholder:{get:function(){return this.__element?this.__element.getAttribute("placeholder"):null},set:function(e){this.__element&&this.__element.setAttribute("placeholder",e)}},disabled:{get:function(){if(this.__element)return!this.__element.getAttribute("contenteditable")},set:function(e){e?this.__element.removeAttribute("contenteditable"):this.__element.setAttribute("contenteditable","true")}},allowDropFiles:{get:function(){return this.__allowDropFiles},set:function(e){this.__allowDropFiles=Boolean(e)}},clearOnBlur:{get:function(){return this.__clearOnBlur},set:function(e){this.__clearOnBlur=!!e}}}),e.prototype.destroy=function(){return this.__removeEventListeners&&this.__removeEventListeners(),!!this.__element&&(this.__element=null,!0)},e.prototype.insert=function(e,n){var r=null,l=window.getSelection();if(this.isInRange())r=l.getRangeAt(0);else if(this.__lastRange)r=this.__lastRange;else{r=document.createRange();var i=Array.prototype.slice.call(this.__element.childNodes),o=i.length,s=i[i.length-1];s&&s.nodeType==Node.ELEMENT_NODE&&"BR"==s.tagName&&(o-=1),r.setStart(this.__element,o),r.setEnd(this.__element,o)}if(!r)return this;var u=a(e);if(!u.length)return this;n||(n={});try{var c=u[u.length-1];n.deleteContents&&r.deleteContents(),u.reverse().forEach(function(e){r.insertNode(e)}),n.selectEnd&&(r.setEndAfter(c),n.selectStart||r.setStartAfter(c),l.removeAllRanges(),l.addRange(r)),n.scrollIntoViewIfNeeded&&t(c),editor.updateValue()}catch(e){}return this},e.prototype.focus=function(e){var t=window.getSelection();if(e&&(e.selectStart||e.selectEnd)){var r=document.createRange(),l=Array.prototype.slice.call(this.__element.childNodes),i=l.length,a=l[l.length-1];return a&&a.nodeType==Node.ELEMENT_NODE&&"BR"==a.tagName&&(i-=1),r.setStart(this.__element,e.selectStart?0:i),r.setEnd(this.__element,e.selectEnd?i:0),t.removeAllRanges(),t.addRange(r),this}if(this.isInRange())return this;if(this.__lastRange&&this.__lastRangeContainers){var o=!1;if(t.removeAllRanges(),n(this.__element,this.__lastRangeContainers.start)||(o=!0),n(this.__element,this.__lastRangeContainers.end)||(o=!0),!o)return t.addRange(this.__lastRange),this}return this.focus({selectEnd:!0})},e.prototype.isInRange=function(){try{var e=window.getSelection().getRangeAt(0);return!!n(this.__element,e.startContainer)&&!!n(this.__element,e.endContainer)}catch(e){return!1}},e.prototype.updateValue=function(){var e=u(this.__element);return this.__value!==e&&(this.__value=e,this.emit("change",e)),this},e.prototype.on=function(e,t){var n=this.__eventHandlerMap;return(n[e]=n[e]||[]).push(t),this},e.prototype.off=function(e,t){var n=this.__eventHandlerMap;if(1===arguments.length)return delete n[e],this;var r=n[e]=n[e]||[],l=r.lastIndexOf(t);return r.splice(l,1),r.length||delete n[e],this},e.prototype.emit=function(e){var t=this.__eventHandlerMap[e];if(!t||0===t.length)return this;for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);return t.forEach(function(t){try{t.apply(this,n)}catch(t){"error"!==e&&this.emit("error",t,e,n)}},this),this},e.prototype.onHotkey=function(e,t){var n={key:e.key,shift:null!=e.shift?Boolean(e.shift):null,ctrl:null!=e.ctrl?Boolean(e.ctrl):null,alt:null!=e.alt?Boolean(e.alt):null,meta:null!=e.meta?Boolean(e.meta):null},r=this.__hotkeyHandlerDataMap;return(r[Number(n.key)]=r[Number(n.key)]||[]).push({hotkey:n,handler:t}),this},e.prototype.offHotkey=function(e,t){var n=this.__hotkeyHandlerDataMap;if(1===arguments.length)return delete n[Number(e.key)],this;for(var l=0,i=n[Number(e.key)]=n[Number(e.key)]||[];l<i.length;)r(e,i[l].hotkey)?i.splice(l,1):l++;return this},e});